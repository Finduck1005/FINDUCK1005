name: Vite ì•±ì„ GitHub Pagesì— ë°°í¬

on:
  # 'main' ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œë§ˆë‹¤ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
  push:
    branches: ['main']
  # GitHub Actions íƒ­ì—ì„œ ì›Œí¬í”Œë¡œìš°ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.
  workflow_dispatch:

# ì›Œí¬í”Œë¡œìš°ì— í•„ìš”í•œ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.
permissions:
  contents: read # ì €ì¥ì†Œ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ìˆëŠ” ê¶Œí•œ
  pages: write   # GitHub Pagesì— ë°°í¬í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ
  id-token: write # OIDC í† í°ì„ ìš”ì²­í•˜ê³  ë°°í¬ì˜ ì¶œì²˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ

jobs:
  # ë¹Œë“œ ì‘ì—…: Vite í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•˜ê³  ë°°í¬í•  ì•„í‹°íŒ©íŠ¸ë¥¼ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
  build:
    runs-on: ubuntu-latest # ì´ ì‘ì—…ì´ ì‹¤í–‰ë  ëŸ¬ë„ˆ í™˜ê²½

    steps:
      - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ ğŸ›ï¸
        uses: actions/checkout@v4 # ì €ì¥ì†Œ ì½”ë“œë¥¼ ëŸ¬ë„ˆì— ë³µì œí•©ë‹ˆë‹¤.

      - name: Node.js í™˜ê²½ ì„¤ì • â˜•
        uses: actions/setup-node@v3 # Node.js í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤.
        with:
          node-version: 18 # ì‚¬ìš©í•  Node.js ë²„ì „ ì§€ì •
          cache: 'npm' # npm ì¢…ì†ì„± ìºì‹± í™œì„±í™”
          cache-dependency-path: package-lock.json # ìºì‹œ í‚¤ë¥¼ ìœ„í•œ ì¢…ì†ì„± íŒŒì¼ ì§€ì •

      - name: í”„ë¡œì íŠ¸ ì¢…ì†ì„± ì„¤ì¹˜ ğŸ“¦
        run: npm install # package.jsonì— ì •ì˜ëœ ì¢…ì†ì„±ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.

      - name: Vite í”„ë¡œì íŠ¸ ë¹Œë“œ ë° Supabase í™˜ê²½ ë³€ìˆ˜ ì „ë‹¬ ğŸ—ï¸
        run: npm run build # Vite ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        env: # GitHub Secretsë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ë¹Œë“œ í”„ë¡œì„¸ìŠ¤ì— ì „ë‹¬í•©ë‹ˆë‹¤.
          VITE_SUPABASE_KEY: ${{ secrets.VITE_SUPABASE_KEY }} # GitHub Secretì—ì„œ Supabase Key ê°€ì ¸ì˜¤ê¸°
          VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL }} # GitHub Secretì—ì„œ Supabase URL ê°€ì ¸ì˜¤ê¸°

      - name: GitHub Pages ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ ğŸš€
        uses: actions/upload-pages-artifact@v3 # ë¹Œë“œëœ ì •ì  íŒŒì¼ì„ GitHub Pages ë°°í¬ìš© ì•„í‹°íŒ©íŠ¸ë¡œ ì—…ë¡œë“œí•©ë‹ˆë‹¤.
        with:
          path: './dist' # Viteì˜ ê¸°ë³¸ ë¹Œë“œ ì¶œë ¥ ë””ë ‰í„°ë¦¬

  # ë°°í¬ ì‘ì—…: ë¹Œë“œëœ ì•„í‹°íŒ©íŠ¸ë¥¼ GitHub Pagesì— ë°°í¬í•©ë‹ˆë‹¤.
  deploy:
    environment:
      name: github-pages # GitHub Pages ë°°í¬ë¥¼ ìœ„í•œ í‘œì¤€ í™˜ê²½ ì´ë¦„
      url: ${{ steps.deployment.outputs.page_url }} # ë°°í¬ëœ ì‚¬ì´íŠ¸ì˜ URLì„ í™˜ê²½ URLë¡œ ì„¤ì •
    runs-on: ubuntu-latest # ì´ ì‘ì—…ì´ ì‹¤í–‰ë  ëŸ¬ë„ˆ í™˜ê²½
    needs: build # ì´ ì‘ì—…ì€ 'build' ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëœ í›„ì—ë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤.

    steps:
      - name: GitHub Pagesì— ë°°í¬ ğŸŒ
        id: deployment # ì´ ë‹¨ê³„ì˜ ID (ì¶œë ¥ ì°¸ì¡°ìš©)
        uses: actions/deploy-pages@v4 # ì—…ë¡œë“œëœ ì•„í‹°íŒ©íŠ¸ë¥¼ GitHub Pagesì— ë°°í¬í•˜ëŠ” ê³µì‹ ì•¡ì…˜